#!/bin/bash
#
# Author: Florian Haftmann, TU Muenchen
#
# Shell interface for adaption table builder.

## environment

PRG="$(basename "$0")"
HASKABELLE_HOME="$(cd "$(dirname "$0")"; cd "$(pwd -P)"; cd ..; pwd)"

if [ -z "$ISABELLE_HOME" ]
then
  ISABELLE=isabelle
  if type -t isatool > /dev/zero
  then
    ISABELLE=isatool
  fi
  ISABELLE_HOME="$($ISABELLE getenv -b ISABELLE_HOME)"
else
  ISABELLE="$ISABELLE_HOME/bin/isabelle"
fi

ISABELLE_PROCESS="$($ISABELLE getenv -b ISABELLE_PROCESS)"

## diagnostics

function fail()
{
  echo "$1" >&2
  exit 2
}

## file names

SRC="$HASKABELLE_HOME/misc/adapt.txt"
DST="$HASKABELLE_HOME/Importer/Adapt/Raw.hs"
PRELUDE_NAME="Prelude"
PRELUDE="$HASKABELLE_HOME/misc/$PRELUDE_NAME"
CONV="$HASKABELLE_HOME/misc/mk_adapt.ML"
CMD="use_thy \"$PRELUDE\"; use \"$CONV\"; MkAdapt.run (theory \"$PRELUDE_NAME\") \"$SRC\" \"$DST\";"

"$ISABELLE_PROCESS" -q -e "$CMD" HOL || exit 1
