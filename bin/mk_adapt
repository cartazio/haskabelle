#!/bin/bash
#
# $Id$
# Author: Florian Haftmann, TU Muenchen
#
# Call to adaption table builder from the shell.

function fail()
{
  echo "$1" >&2
  exit 2
}

EXECPATH="$(dirname "$0")/.."

[ -z "$EXECPATH" ] && fail "$0 must be called with explicit path"

cd "$EXECPATH"

[ -z "$ISABELLE" ] && ISABELLE="$(isatool getenv -b ISABELLE)"

SRC="$EXECPATH/adapt/adapt.txt"
DST="$EXECPATH/Importer/AdaptMapping.hs"
PRELUDE="$EXECPATH/adapt/Prelude"
CONV="$EXECPATH/adapt/mk_adapt.ML"
CMD="use_thy \"$PRELUDE\"; use \"$CONV\"; MkAdapt.run (theory \"Main\") \"$SRC\" \"$DST\";"

"$ISABELLE" -q -e "$CMD" HOL || exit 1
