#!/bin/bash

function fail()
{
  echo "$1" >&2
  exit 2
}

EXECPATH="$(dirname "$0")/.."

[ -z "$EXECPATH" ] && fail "$0 must be called with absolute path"

cd "$EXECPATH"

for SRC in ex/src_hs/*.hs
do
  DST=ex/dst_thy/
  ./bin/import_file "$SRC" "$DST" || fail "could not import $SRC"
done

cd ex/dst_thy/
for THY in *.thy
do
  THY_NAME="$(basename $THY .thy)"
  DST="../../ex/dst_hs/"
  isatool codegen HOL "$THY_NAME" "\"$THY_NAME.*\" in Haskell file \"$DST\"" || fail "could not re_import $THY"
done
