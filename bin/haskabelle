#!/bin/bash
#
# Author: Florian Haftmann, TU Muenchen
#
# Shell interface for Haskabelle.

## environment

PRG="$(basename "$0")"
HASKABELLE_HOME="$(cd "$(dirname "$0")"; cd "$(pwd -P)"; cd ..; pwd)"
if [ -z "$GHC" ]
then
  GHC=ghc
fi

## invoking Haskabelle

HASKABELLE_BIN="$HASKABELLE_HOME/bin/haskabelle_bin"
if [ -x "$HASKABELLE_BIN" ]
then
  "$HASKABELLE_BIN" "$PRG" "$@" || exit $?
else
  ARGS="\"$PRG\""
  for ARG in "$@"
  do
    ARGS="$ARGS, \"$1\""
    shift
  done
  BUILDDIR="$HASKABELLE_HOME/build"
  echo Running Haskabelle from source...
  "$GHC" -fglasgow-exts -i -i"$HASKABELLE_HOME" -odir "$BUILDDIR" -hidir "$BUILDDIR" -stubdir "$BUILDDIR" -e "mainInterface [$ARGS]" "$HASKABELLE_HOME/Main.hs" || exit $?
fi
