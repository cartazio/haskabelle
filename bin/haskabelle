#!/bin/bash
#
# Author: Florian Haftmann, TU Muenchen
#
# Shell interface for Haskabelle.

## environment

PRG="$(basename "$0")"
HASKABELLE_HOME="$(cd "$(dirname "$0")"; cd "$(pwd -P)"; cd ..; pwd)"
DEFAULT_ADAPT="$HASKABELLE_HOME/default"
if [ -z "$GHC" ]
then
  GHC=ghc
fi

## invoking Haskabelle

HASKABELLE_BIN="$HASKABELLE_HOME/bin/haskabelle_bin"
if [ -x "$HASKABELLE_BIN" ]
then
  "$HASKABELLE_BIN" "$PRG" "$DEFAULT_ADAPT" "$@" || exit $?
else
  ARGS="\"$PRG\", \"$DEFAULT_ADAPT\""
  for ARG in "$@"
  do
    ARGS="$ARGS, \"$1\""
    shift
  done
  echo Running Haskabelle from source...
  BUILDDIR="$HASKABELLE_HOME/build"
  if [ -d "$BUILDDIR" ]
  then
    "$GHC" -package haskell-src-exts-0.4.8 -fglasgow-exts -i -i"$HASKABELLE_HOME" -odir $BUILDDIR -hidir $BUILDDIR -stubdir $BUILDDIR -e "mainInterface [$ARGS]" "$HASKABELLE_HOME/Main.hs" || exit $?
  else
    "$GHC" -package haskell-src-exts-0.4.8  -fglasgow-exts -i -i"$HASKABELLE_HOME" -e "mainInterface [$ARGS]" "$HASKABELLE_HOME/Main.hs" || exit $?
  fi
fi
