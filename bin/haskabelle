#!/bin/bash
#
# Author: Florian Haftmann, TU Muenchen
#
# Shell interface for Haskabelle.

## environment

PRG="$(basename "$0")"
HASKABELLE_HOME="$(cd "$(dirname "$0")"; cd "$(pwd -P)"; cd ..; pwd)"
if [ -z "$GHC" ]
then
  GHC=ghc
fi

## diagnostics

function usage()
{
  echo
  echo "Usage: $PRG SRC1 .. SRCn DST"
  echo
  echo "  Import Haskell files SRC1 .. SRCn into Isabelle theories in directory DST."
  echo
  exit 1
}

function fail()
{
  echo "$1" >&2
  exit 2
}

## processing command line arguments

if [ $# -lt 2 ]
then
  usage
fi

SRCS="\"$1\""
echo "importing $1..."
shift
for SPEC in "$@"
do
  if [ $# -gt 1 ]
  then
    echo "importing $1..."
    SRCS="$SRCS, \"$1\""
    shift
  fi
done

DST="\"$1\""
echo "...into $1"

## invoking Haskabelle

"$GHC" -fglasgow-exts -i -i"$HASKABELLE_HOME" -e "importFiles defaultCustomisations [$SRCS] $DST" "$HASKABELLE_HOME/Importer.hs" || exit $?
